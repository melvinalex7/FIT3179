{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "height": 400,
    "width": 400,
    "title": {
      "text": "World Happiness Rankings (2015-2019)",
      "frame": "bounds"
    },
    "params": [
        {
        "name": "region_selection",
        "bind": {
          "input": "select",
          "options": [
            null,
            "Americas",
            "Europe",
            "Africa",
            "Asia",
            "Oceania"
          ],
          "labels": [
            "Show All",
            "Americas",
            "Europe",
            "Africa",
            "Asia",
            "Oceania"
          ],
          "name": "Region Selection: "
        }
      }
    
      ],
    "data": {
      "name": "report_source",
      "url": "https://raw.githubusercontent.com/melvinalex7/FIT3179/main/Assignment_2/data/Happiness_Report_Dataset_Cleaned.csv"
    },
    "transform": [
      {
        "lookup": "Country",
        "from": {
          "data": {
            "url": "https://raw.githubusercontent.com/melvinalex7/FIT3179/main/Assignment_2/data/continents.csv"
          },
          "key": "name",
          "fields": ["region"]
        }
      },
      {
        "filter": "region_selection == null || datum.region == region_selection"
      },
      {
        "window": [{
            "op": "average",
            "field": "Happiness_Rank",
            "as": "happiness_rank"
          }],
          "groupby": ["Country"],
          "sort": [{ "field": "Happiness_Rank", "order": "ascending" }]
      },
      { "filter": "datum.happiness_rank <= 10" }],
    "mark": {"type": "line", "orient": "vertical"},
    "encoding": {
      "x": {"field": "Year", "type": "ordinal"},
      "y": {
        "field": "Happiness_Rank", 
        "type": "ordinal",
        "sort": {"field": "happiness_rank", "order":"ascending"}
      },
      "tooltip": [
        {"field": "Country", "type": "nominal", "title": "Country"},
        {"field": "Happiness_Rank", "type": "quantitative", "title": "Happiness Rank", "format": ".4"}],
      "color": {
        "field": "Country", "type": "nominal"
      }
    }
  }